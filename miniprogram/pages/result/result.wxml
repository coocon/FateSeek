<navigation-bar 
  title="八字分析" 
  back="{{true}}" 
  color="black" 
  background="#FFF">
</navigation-bar>

<view class="result-container" 
      bindtouchstart="handleTouchStart" 
      bindtouchmove="handleTouchMove">
  <!-- 基本信息展示 -->
  <basic-info 
    name="{{params.name}}"
    gender="{{params.gender}}"
    birthDateTime="{{params.birthDateTime}}"
    region="{{params.region}}"
  />

  <!-- 八字展示区 -->
  <bazi-display 
    year="{{baziInfo.year}}"
    month="{{baziInfo.month}}"
    day="{{baziInfo.day}}"
    time="{{baziInfo.time}}"
  />

  <!-- 思考过程展示区 -->
  <view class="thinking-section {{showThinking ? 'expanded' : ''}}">
    <view class="thinking-header sticky" bindtap="toggleThinking">
      <text>思考过程</text>
      <view class="thinking-status" wx:if="{{thinking}}">
        <text class="loading-text">思考中</text>
        <view class="loading-dots">
          <text>.</text><text>.</text><text>.</text>
        </view>
      </view>
      <view class="toggle-icon">{{showThinking ? '收起' : '展开'}}</view>
    </view>
    
    <view class="thinking-content" hidden="{{!showThinking}}">
      <towxml nodes="{{reasoningContentMarkdown}}" />
    </view>
  </view>

  <!-- 分析结果展示区 -->
  <view class="analysis-content">
    <view class="header sticky">
      <text class="title">分析结果</text>
      <view class="header-actions">
        <button class="favorite-btn" bindtap="saveToFavorites" disabled="{{analysisCompleted ? false : true}}">
          <text class="favorite-icon">⭐</text>
          <text class="favorite-text">收藏完整结果</text>
        </button>
      </view>
    </view>

    <!-- 分析步骤
    <view class="analysis-steps">
      <block wx:for="{{analysisSteps}}" wx:key="index">
        <view class="step-item {{item ? 'show' : ''}}">
          <view class="step-number">步骤 {{index + 1}}</view>
          <view class="step-content">{{item}}</view>
        </view>
      </block>
    </view> -->
    <towxml nodes="{{fullContentMarkdown}}" />
  </view>

  <!-- VIP高级分析功能区 -->
  <view class="vip-section">
    <view class="vip-header">
      <text class="vip-title">🌟 VIP学习内容</text>
      <text class="vip-desc">文化学习，知识普及</text>
    </view>

    <!-- VIP功能列表 -->
    <view class="vip-features">
      <view
        class="vip-feature {{vipFeatures.includes(item.id) ? 'available' : 'locked'}}"
        wx:for="{{vipFeatureList}}"
        wx:key="id"
        bindtap="onVIPFeatureTap"
        data-feature="{{item}}"
      >
        <view class="feature-icon">
          <text class="icon">{{item.icon}}</text>
          <view class="lock-icon" wx:if="{{!vipFeatures.includes(item.id)}}">🔒</view>
        </view>
        <view class="feature-content">
          <text class="feature-name">{{item.name}}</text>
          <text class="feature-desc">{{item.description}}</text>
        </view>
        <view class="feature-action">
          <text class="action-text">{{vipFeatures.includes(item.id) ? '查看' : '升级VIP'}}</text>
        </view>
      </view>
    </view>

    <!-- VIP升级提示 -->
    <view class="vip-upgrade-banner" wx:if="{{!membershipInfo.isVIP && !membershipInfo.isTrial}}">
      <view class="banner-content">
        <text class="banner-title">解锁全部学习内容</text>
        <text class="banner-desc">传统文化学习、职业素养提升、中医文化学习、积极心理健康教育</text>
        <button class="banner-btn" bindtap="navigateToVIP">开始学习</button>
      </view>
    </view>

    <!-- 试用期提示 -->
    <view class="trial-banner" wx:if="{{membershipInfo.isTrial}}">
      <view class="banner-content">
        <text class="banner-title">🎁 学习体验中</text>
        <text class="banner-desc">剩余{{membershipInfo.remainingDays}}天，体验全部学习内容</text>
      </view>
    </view>
  </view>

  <!-- 添加免责声明 -->
  <view class="disclaimer">
    本结果由DeepSeek智能算法生成，内容仅供娱乐参考。请您理性看待，切勿迷信或用于重要决策。AI预测不代表真实命运，请以积极心态面对生活。
  </view>
</view> 