<navigation-bar
  title="VIPä¼šå‘˜"
  back="{{true}}"
  color="black"
  background="#FFF">
</navigation-bar>

<view class="vip-container">
  <!-- ç”¨æˆ·ä¼šå‘˜çŠ¶æ€å¡ç‰‡ -->
  <view class="membership-card {{membershipInfo.isVIP ? 'vip-active' : 'free-user'}}">
    <view class="card-header">
      <view class="user-avatar">
        <image src="/images/vip-crown.png" class="crown-icon" wx:if="{{membershipInfo.isVIP}}"></image>
        <text class="membership-type">{{membershipInfo.isTrial ? 'è¯•ç”¨ç”¨æˆ·' : (membershipInfo.isVIP ? 'VIPä¼šå‘˜' : 'æ™®é€šç”¨æˆ·')}}</text>
      </view>
      <view class="membership-info">
        <text class="member-type-text">{{membershipInfo.memberType === 'monthly' ? 'æœˆåº¦ä¼šå‘˜' : (membershipInfo.memberType === 'quarterly' ? 'å­£åº¦ä¼šå‘˜' : (membershipInfo.memberType === 'yearly' ? 'å¹´åº¦ä¼šå‘˜' : 'å…è´¹ç”¨æˆ·'))}}</text>
        <text class="remaining-days" wx:if="{{membershipInfo.remainingDays > 0}}">
          å‰©ä½™{{membershipInfo.remainingDays}}å¤©
        </text>
        <text class="expired-text" wx:if="{{membershipInfo.remainingDays === 0 && membershipInfo.memberType !== 'free'}}">
          å·²è¿‡æœŸ
        </text>
      </view>
    </view>

    <view class="card-body">
      <text class="status-description" wx:if="{{membershipInfo.isVIP}}">
        æ‚¨æ­£åœ¨äº«å—VIPé«˜çº§åˆ†æåŠŸèƒ½
      </text>
      <text class="status-description" wx:elif="{{membershipInfo.isTrial}}">
        å…è´¹è¯•ç”¨æœŸï¼Œå°½æƒ…ä½“éªŒVIPåŠŸèƒ½
      </text>
      <text class="status-description" wx:else>
        å‡çº§VIPï¼Œè§£é”æ·±åº¦åˆ†æåŠŸèƒ½
      </text>
    </view>
  </view>

  <!-- å…è´¹è¯•ç”¨æç¤º -->
  <view class="trial-banner" wx:if="{{!membershipInfo.isVIP && canStartTrial}}">
    <view class="trial-content">
      <text class="trial-icon">ğŸ</text>
      <view class="trial-info">
        <text class="trial-title">å…è´¹è¯•ç”¨3å¤©</text>
        <text class="trial-desc">ä½“éªŒæ‰€æœ‰VIPé«˜çº§åŠŸèƒ½</text>
      </view>
      <button class="trial-btn" bindtap="startTrial">ç«‹å³è¯•ç”¨</button>
    </view>
  </view>

  <!-- VIPåŠŸèƒ½ç‰¹æƒ -->
  <view class="features-section">
    <view class="section-header">
      <text class="section-title">VIPå­¦ä¹ å†…å®¹</text>
      <text class="section-desc">æ–‡åŒ–å­¦ä¹ ï¼ŒçŸ¥è¯†æ™®åŠ</text>
    </view>

    <view class="features-list">
      <view
        class="feature-item {{membershipInfo.features.includes(item.id) ? 'available' : 'locked'}}"
        wx:for="{{VIP_FEATURES}}"
        wx:key="id"
        bindtap="showFeatureDetail"
        data-id="{{item.id}}"
      >
        <view class="feature-icon">
          <text class="icon">{{item.icon}}</text>
          <view class="lock-icon" wx:if="{{!membershipInfo.features.includes(item.id)}}">ğŸ”’</view>
        </view>
        <view class="feature-content">
          <text class="feature-name">{{item.name}}</text>
          <text class="feature-desc">{{item.description}}</text>
        </view>
        <view class="feature-status">
          <text class="status-text">{{membershipInfo.features.includes(item.id) ? 'å·²è§£é”' : 'VIPä¸“äº«'}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- VIPäº§å“é€‰æ‹© -->
  <view class="products-section" wx:if="{{!membershipInfo.isVIP}}">
    <view class="section-header">
      <text class="section-title">é€‰æ‹©å­¦ä¹ å¥—é¤</text>
      <text class="section-desc">ä¼˜è´¨å†…å®¹ï¼Œå­¦ä¹ ä½“éªŒ</text>
    </view>

    <view class="products-list">
      <view
        class="product-item {{selectedProduct && selectedProduct.id && selectedProduct.id === item.id ? 'selected' : ''}}"
        wx:for="{{[VIP_PRODUCTS.monthly, VIP_PRODUCTS.quarterly, VIP_PRODUCTS.yearly]}}"
        wx:key="id"
        bindtap="selectProduct"
        data-type="{{item.id.replace('vip_', '')}}"
      >
        <view class="product-header">
          <text class="product-name">{{item.name}}</text>
          <view class="product-price">
            <text class="price-symbol">Â¥</text>
            <text class="price-value">{{formatPrice(item.price)}}</text>
          </view>
        </view>
        <text class="product-desc">{{item.description}}</text>
        <view class="product-badge" wx:if="{{item.id === 'vip_yearly'}}">æœ€åˆ’ç®—</view>
      </view>
    </view>

    <button class="upgrade-btn" bindtap="selectProduct" data-type="monthly">
      å¼€é€šå­¦ä¹ å†…å®¹
    </button>
  </view>

  <!-- ç®¡ç†åŠŸèƒ½ -->
  <view class="management-section" wx:if="{{membershipInfo.isVIP}}">
    <view class="section-header">
      <text class="section-title">å­¦ä¹ ç®¡ç†</text>
    </view>
    <button class="management-btn" bindtap="viewOrders">æŸ¥çœ‹è®¢å•è®°å½•</button>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>

<!-- æ”¯ä»˜ç¡®è®¤å¼¹çª— -->
<view class="payment-modal" wx:if="{{showPaymentModal && selectedProduct && selectedProduct.id}}">
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">ç¡®è®¤å¼€é€šå­¦ä¹ å†…å®¹</text>
    </view>
    <view class="modal-body">
      <view class="product-summary">
        <text class="product-name">{{selectedProduct.name}}</text>
        <view class="product-price">
          <text class="price-symbol">Â¥</text>
          <text class="price-value">{{formatPrice(selectedProduct.price)}}</text>
        </view>
      </view>
      <text class="product-desc">{{selectedProduct.description}}</text>
    </view>
    <view class="modal-footer">
      <button class="modal-btn cancel" bindtap="closePaymentModal">å–æ¶ˆ</button>
      <button class="modal-btn confirm" bindtap="confirmPayment">ç¡®è®¤æ”¯ä»˜</button>
    </view>
  </view>
  <view class="modal-mask" bindtap="closePaymentModal"></view>
</view>